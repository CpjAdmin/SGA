function CargarTablaDelegados(){MostrarCargando();$.ajax({type:"POST",url:apiUrl+"/api/Asamblea/Delegado/ListaDelegados",contentType:"application/json; charset=utf-8",dataType:"JSON",error:function(n,t,i){mensajeError=n.status+"\n"+n.responseText;"\n"+i;alertaError("Seleccionar Delegados",mensajeError);CerrarCargando()},success:function(n){CargarFilas(n);CerrarCargando()}})}function CargarFilas(n){var t=[],i,r;n.map(function(n){t.push([n.Id_delegado,n.Cedula,n.Nombre,n.Num_paleta,n.Centro,n.Institucion,n.Lugar_Trabajo,n.Tel_Celular,n.Email,n.Foto,spanVotar(n.I_votar),spanEstado(n.I_estado),'<img class="tooltipImgM" src="images/Iconos/update.png" style="cursor:pointer" data-toggle="tooltip" title="Modificar" />','<img class="tooltipImgB" src="images/Iconos/delete.png" style="cursor:pointer" data-toggle="tooltip" title="Eliminar" />'])});tabla=objtabla.DataTable({data:t,dom:"Bfrtip",buttons:[{extend:"excelHtml5",text:"EXCEL",exportOptions:{columns:[0,1,2,3,4,5,6,7,8,9,10,11]},title:function(){return nombreReporte},sheetName:"Reporte",className:"btn-success ml-2"}],columns:[null,null,null,null,null,null,null,null,null,null,{className:"textoCentrado"},{className:"textoCentrado"},{width:"5%",sortable:!1,className:"textoCentrado"},{width:"5%",sortable:!1,className:"textoCentrado"}],paging:!0,lengthChange:!1,searching:!0,ordering:!0,info:!0,pageLength:22,autoWidth:!1,destroy:!0,deferRender:!0,scrollY:$(document).height()-415+"px",scrollX:!0});tabla.draw();$(".btn-group").width("35%");i='<button type="button" class="btn btn-block bg-gradient-primary" id="btnTrasladar"style="margin-top: 0rem;">TRASLADAR USUARIOS<\/button>';r='<button type="button" class="btn btn-block bg-gradient-primary" id="btnAgregar" style="margin-right:8px;">NUEVO DELEGADO<\/button>';$(".buttons-excel").before(r);$(".buttons-excel").before(i);$("#tablaDelegados tbody").on("click","tr",function(){$(this).hasClass("selected")||(tabla.$("tr.selected").removeClass("selected"),$(this).addClass("selected"))})}function spanEstado(n){var t=n==="A"?"ACTIVO":"INACTIVO";switch(t){case"ACTIVO":return'<small class="badge badge-success">'+t+"<\/small>";case"INACTIVO":return'<small class="badge badge-danger">'+t+"<\/small>";default:return'<small class="badge badge-info">'+t+"<\/small>"}}function spanVotar(n){var t=n==="S"?"SI":"NO";switch(t){case"SI":return'<small class="badge badge-success">'+t+"<\/small>";case"NO":return'<small class="badge badge-danger">'+t+"<\/small>";default:return'<small class="badge badge-info">'+t+"<\/small>"}}function validarDatosDelegados(){return $("#cedula").val().length<7?(alertaError("Datos Delegados","La cédula debe ser mayor a 7 caracteres"),1):$.trim($("#nombre").val()).length<5?(alertaError("Datos Delegados","El nombre debe ser mayor a 5 caracteres"),1):$.trim($("#numPaleta").val()).length<=0||$("#numPaleta").val()==="0"?(alertaError("Datos Delegados","Debe indicar un número de paleta"),1):$.trim($("#centro").val()).length<3?(alertaError("Datos Delegados","Debe indicar un centro de trabajo mayor a 3 caracteres"),1):$.trim($("#institucion").val()).length<3?(alertaError("Datos Delegados","Debe indicar una institución de trabajo mayor a 3 caracteres"),1):$.trim($("#lugar_trabajo").val()).length<3?(alertaError("Datos Delegados","Debe indicar un lugar de trabajo mayor a 3 caracteres"),1):$.trim($("#celular").val()).length<8?(alertaError("Datos Delegados","Debe indicar un número de celular valido (8)"),1):validateEmail($.trim($("#email").val()))?0:(alertaError("Datos Delegados","Debe indicar un email valido"),1)}function GuardarDatos(){MostrarCargando();DatosD.Cedula=$("#cedula").val();DatosD.Nombre=$("#nombre").val();DatosD.Num_paleta=$("#numPaleta").val();DatosD.Centro=$("#centro").val();DatosD.Institucion=$("#institucion").val();DatosD.Lugar_Trabajo=$("#lugar_trabajo").val();DatosD.Tel_Celular=$("#celular").val();DatosD.Email=$("#email").val();DatosD.Foto=$("#foto").val();DatosD.I_votar=$("#chkvotar").is(":checked")?"S":"N";DatosD.I_estado=$("#chkactivo").is(":checked")?"A":"I";DatosD.Usuario=sessionStorage.Cedula;$.ajax({type:"POST",url:apiUrl+"/api/Asamblea/Delegado/InsertarDelegado",data:JSON.stringify(DatosD),contentType:"application/json; charset=utf-8",dataType:"JSON",headers:{Auth:sessionStorage.Cedula+":"+sessionStorage.Token},error:function(n,t,i){mensajeError=n.status+"\n"+n.responseText;"\n"+i;alertaError("Guardar datos",mensajeError);CerrarCargando()},success:function(n){n.Error===0?(alertaExito("Guardar datos","Datos Guardardos correctamente"),CargarTablaDelegados(),CerrarCargando()):n.Error===1?(alertaInfo("Guardar datos",n.Mensaje),CerrarCargando()):(alertaError("Guardar datos",n.Mensaje),CerrarCargando())}})}function ModificarDatos(){MostrarCargando();DatosD.Id_delegado=$("#id").val();DatosD.Cedula=$("#cedula").val();DatosD.Nombre=$("#nombre").val();DatosD.Num_paleta=$("#numPaleta").val();DatosD.Centro=$("#centro").val();DatosD.Institucion=$("#institucion").val();DatosD.Lugar_Trabajo=$("#lugar_trabajo").val();DatosD.Tel_Celular=$("#celular").val();DatosD.Email=$("#email").val();DatosD.Foto=$("#foto").val();DatosD.I_votar=$("#chkvotar").is(":checked")?"S":"N";DatosD.I_estado=$("#chkactivo").is(":checked")?"A":"I";DatosD.Usuario=sessionStorage.Cedula;$.ajax({type:"POST",url:apiUrl+"/api/Asamblea/Delegado/ActualizarDelegado",data:JSON.stringify(DatosD),contentType:"application/json; charset=utf-8",dataType:"JSON",headers:{Auth:sessionStorage.Cedula+":"+sessionStorage.Token},error:function(n,t,i){mensajeError=n.status+"\n"+n.responseText;"\n"+i;alertaError("Modificar datos",mensajeError);CerrarCargando()},success:function(n){n.Error===0?(alertaExito("Modificar datos","Datos Modificados correctamente"),CargarTablaDelegados(),CerrarCargando()):n.Error===1?(alertaInfo("Modificar datos",n.Mensaje),CerrarCargando()):(alertaError("Modificar datos",n.Mensaje),CerrarCargando())}})}function GuardarModificarDelegado(n){n==="guardar"?GuardarDatos():ModificarDatos()}function TrasladarUsuarios(){MostrarCargando();DatosD.Usuario=sessionStorage.Cedula;$.ajax({type:"POST",url:apiUrl+"/api/Asamblea/Delegado/TrasladarUsuarios",data:JSON.stringify(DatosD),contentType:"application/json; charset=utf-8",dataType:"JSON",headers:{Auth:sessionStorage.Cedula+":"+sessionStorage.Token},error:function(n,t,i){mensajeError=n.status+"\n"+n.responseText;"\n"+i;alertaError("Generación de usuarios",mensajeError);CerrarCargando()},success:function(n){n.Error===0?(alertaExito("Modificar datos",n.Mensaje),CerrarCargando()):(alertaError("Modificar datos",n.Mensaje),CerrarCargando())}})}function EliminarDatos(n){MostrarCargando();DatosD.Id_delegado=n;DatosD.Usuario=sessionStorage.Cedula;$.ajax({type:"POST",url:apiUrl+"/api/login/Delegado/EliminarDelegado",data:JSON.stringify(DatosD),contentType:"application/json; charset=utf-8",dataType:"JSON",headers:{Auth:sessionStorage.Cedula+":"+sessionStorage.Token},error:function(n,t,i){mensajeError=n.status+"\n"+n.responseText;"\n"+i;alertaError("Guardar datos",mensajeError);CerrarCargando()},success:function(n){n.Error===0?(alertaExito("Eliminar datos","Datos Eliminados correctamente"),CargarTablaDelegados(),CerrarCargando()):n.Error===1?(alertaInfo("Eliminar datos",n.Mensaje),CerrarCargando()):(alertaError("Eliminar datos",n.Mensaje),CerrarCargando())}})}var apiUrl=sessionStorage.Uri,objtabla=$("#tablaDelegados"),tabla,nombreReporte="Lista de Delegados",DatosD={Id_delegado:"",Cedula:"",Num_paleta:0,Nombre:"",Institucion:"",Centro:"",Lugar_Trabajo:"",Tel_Celular:"",Email:"",Foto:"",I_estado:"",Usuario:"",Terminal:"",I_votar:""};$(document).ready(function(){setTimeout(function(){CargarTablaDelegados()},500);$(document).on("click","#btnCargar",function(){$("#Miarchivo").click()});$("#Miarchivo").change(function(){MostrarCargando();var n=$("#Miarchivo")[0].files[0],t=n.name.split(".").pop();if(t=t.toLowerCase(),n){if(t!=="txt"){alertaError("Cargar archivo","Solo se permiten archivos .txt");CerrarCargando();return}if(n.size>5242880){alertaError("Cargar archivo","El tamaño del archivo no debe sobrepasar los 5 MB");CerrarCargando();return}data=new FormData;data.append("file",n);$.ajax({url:apiUrl+"/api/login/Delegado/CargarArchivo",type:"POST",headers:{Auth:sessionStorage.Cedula+":"+sessionStorage.Token},data:data,cache:!1,processData:!1,contentType:!1,success:function(n){CerrarCargando();alertaInfo("Guardar datos",n);CargarTablaDelegados()},error:function(n,t,i){mensajeError=n.status+"\n"+n.responseText;"\n"+i;alertaError("cargar archivo",mensajeError);CerrarCargando()}})}});$(document).on("click","#btnAgregar",function(){$("#modal-lg-Delegado").data("tipo","guardar");$("#modal-lg-Delegado").modal("show");$("#lblDelegado").text("NUEVO DELEGADO");$("#id").val("");$("#cedula").val("");$("#nombre").val("");$("#numPaleta").val("");$("#centro").val("");$("#institucion").val("");$("#lugar_trabajo").val("");$("#celular").val("");$("#email").val("");$("#foto").val("");$("#chkvotar").prop("checked",!0).change();$("#chkactivo").prop("checked",!0).change()});$(document).on("click",".tooltipImgM",function(){var n=$(this).closest("tr").find("td:eq(0)").text(),t=$(this).closest("tr").find("td:eq(1)").text(),i=$(this).closest("tr").find("td:eq(2)").text(),r=$(this).closest("tr").find("td:eq(3)").text(),u=$(this).closest("tr").find("td:eq(4)").text(),f=$(this).closest("tr").find("td:eq(5)").text(),e=$(this).closest("tr").find("td:eq(6)").text(),o=$(this).closest("tr").find("td:eq(7)").text(),s=$(this).closest("tr").find("td:eq(8)").text(),h=$(this).closest("tr").find("td:eq(9)").text(),c=$(this).closest("tr").find("td:eq(10)").text(),l=$(this).closest("tr").find("td:eq(11)").text();$("#modal-lg-Delegado").data("tipo","modificar");$("#modal-lg-Delegado").modal("show");$("#lblDelegado").text("MODIFICAR USUARIO");$("#id").val(n);$("#cedula").val(t);$("#nombre").val(i);$("#numPaleta").val(r);$("#centro").val(u);$("#institucion").val(f);$("#lugar_trabajo").val(e);$("#celular").val(o);$("#email").val(s);$("#foto").val(h);c==="SI"?$("#chkvotar").prop("checked",!0).change():$("#chkvotar").prop("checked",!1).change();l==="ACTIVO"?$("#chkactivo").prop("checked",!0).change():$("#chkactivo").prop("checked",!1).change()});$(document).on("click",".tooltipImgB",function(){var n=$(this).closest("tr").find("td:eq(0)").text();Swal.close();Swal.fire({title:"Eliminar Datos",html:"¿Desea Eliminar el delegado <b>"+n+"<\/b>?",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:"Aceptar"}).then(function(t){t.value&&EliminarDatos(n)})});$(document).on("click","#btnGuardar",function(){validarDatosDelegados()!==1&&(Swal.close(),Swal.fire({title:"Guardar Datos",text:"¿Desea guardar los datos?",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:"Aceptar"}).then(function(n){n.value&&($("#modal-lg-Delegado").modal("hide"),GuardarModificarDelegado($("#modal-lg-Delegado").data("tipo")))}))});$(document).on("click","#btnTrasladar",function(){Swal.close();Swal.fire({title:"Guardar Datos",text:"¿Desea generar el proceso de creación de usuarios?",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:"Aceptar"}).then(function(n){n.value&&TrasladarUsuarios()})})});