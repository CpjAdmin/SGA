function CargarTablaGestion(){MostrarCargando();$.ajax({type:"POST",url:apiUrl+"/api/Asamblea/Gestion/ListaGestion",contentType:"application/json; charset=utf-8",dataType:"JSON",error:function(n,t,i){mensajeError=n.status+"\n"+n.responseText;"\n"+i;alertaError("Uso de la Palabra - Delegados",mensajeError);CerrarCargando()},success:function(n){listaPaletas=[];n.map(function(n){listaPaletas.push(n.Num_paleta)});CargarFilas(n);CerrarCargando()}})}function CargarFilas(n){var t=[];n.map(function(n){t.push([n.Orden,TipoPapeletaPosicion(n.Reincide,n.Num_paleta,n.Num_posicion),n.Cedula,n.Nombre,'<img class="tooltipImgB" src="images/Iconos/delete.png" style="cursor:pointer" data-toggle="tooltip" title="Eliminar" />'])});tabla=objtabla.DataTable({data:t,columns:[{visible:!1},{width:"5%",sortable:!1,className:"textoCentrado text-bold"},{sortable:!1},{sortable:!1},{width:"5%",sortable:!1,className:"textoCentrado"}],paging:!1,lengthChange:!1,searching:!1,info:!0,autoWidth:!1,destroy:!0,deferRender:!0,rowReorder:!0,scrollY:$(document).height()-550+"px",scrollCollapse:!0});tabla.draw();$("#tablaGestion tbody").on("click","tr",function(){$(this).hasClass("selected")||(tabla.$("tr.selected").removeClass("selected"),$(this).addClass("selected"))})}function TipoPapeletaPosicion(n,t,i){switch(tipo){case"D":return"<p style='margin:0px' data-idR='"+n+"' data-idO='"+t+"'>"+t+"<\/p>";case"C":return"<p style='margin:0px' data-idR='"+n+"' data-idO='"+i+"'>"+i+"<\/p>"}}function obtenerPapeletas(){$.ajax({type:"POST",async:!0,url:apiUrl+"/api/Asamblea/PapeletaRonda/ListadoPapeletas",contentType:"application/json; charset=utf-8",dataType:"JSON",error:function(n,t,i){mensajeError=n.status+"\n"+n.responseText;"\n"+i;alertaError("Carga de Papeletas",mensajeError)},success:function(n){if(n!==null&&n.length>0){Id_papeleta=n[0].Id_papeleta;$("#lblGestion").html('USO DE LA PALABRA  ( <b class="text-danger"> '+n[0].Id_papeleta+" - "+n[0].Nombre+" <\/b>)");CargarTablaGestionC(Id_papeleta);var t=[];$.each(n,function(n,i){var r=$('<span id="'+i.Id_papeleta+'" class="dropdown-item">'+i.Id_papeleta+" - "+i.Nombre+'<\/span><div class="dropdown-divider"><\/div>');t.push(r)});$("#listaPapeletas").append(t);$(".dropdown-item").click(function(n){n.preventDefault();Id_papeleta=$(this).attr("id");var t=$(this).text();$("#lblGestion").html('USO DE LA PALABRA  ( <b class="text-danger"> '+t+" <\/b>)");CargarTablaGestionC(Id_papeleta)})}}})}function activarActivaDesactivaA(n,t){tipo==="D"?t==="N"?n==="A"?($("#greenC").addClass("greenAnimation"),$("#yellowC").addClass("yellowAnimation"),$(".red").css("opacity",".1")):($("#greenC").removeClass("greenAnimation"),$("#yellowC").removeClass("yellowAnimation"),$(".red").css("opacity",".1")):n==="A"?($("#greenC").addClass("greenAnimationR"),$("#yellowC").addClass("yellowAnimationR"),$(".red").css("opacity",".1")):($("#greenC").removeClass("greenAnimationR"),$("#yellowC").removeClass("yellowAnimationR"),$(".red").css("opacity",".1")):n==="A"?($("#greenC").addClass("greenAnimationC"),$("#yellowC").addClass("yellowAnimationC"),$(".red").css("opacity",".1")):($("#greenC").removeClass("greenAnimationC"),$("#yellowC").removeClass("yellowAnimationC"),$(".red").css("opacity",".1"))}function CargarTablaGestionC(n){MostrarCargando();$.ajax({type:"POST",url:apiUrl+"/api/Asamblea/Gestion/ListaGestionC",contentType:"application/json; charset=utf-8",data:JSON.stringify(n),dataType:"JSON",error:function(n,t,i){mensajeError=n.status+"\n"+n.responseText;"\n"+i;alertaError("Delegados en la gestion de la palabra",mensajeError);CerrarCargando()},success:function(n){CargarFilas(n);CerrarCargando()}})}function ActualizarGestion(n){MostrarCargando();DatosG.Num_paleta=idPaleta;DatosG.Cedula=cedulaO;DatosG.Usuario=login;DatosG.Tiempo=n;$.ajax({type:"POST",url:apiUrl+"/api/Asamblea/Gestion/ModificarGestion",data:JSON.stringify(DatosG),contentType:"application/json; charset=utf-8",dataType:"JSON",headers:{Auth:login+":"+token},error:function(n,t,i){mensajeError=n.status+"\n"+n.responseText;"\n"+i;alertaErrorMin(mensajeError);CerrarCargando()},success:function(n){n.Error===0?(alertaExitoMin("TIEMPO ALMACENADO CON EXITO."),CargarTablaGestion(),idPaleta="0",paletaO="0",CerrarCargando()):(alertaErrorMin(n.Mensaje.toUpperCase()),CerrarCargando())}})}function IngresarGestionC(n){MostrarCargando();DatosG.Num_posicion=paletaO;DatosG.Cedula=cedulaO;DatosG.Usuario=login;DatosG.Tiempo=n;$.ajax({type:"POST",url:apiUrl+"/api/Asamblea/Gestion/IngresarGestionC",data:JSON.stringify(DatosG),contentType:"application/json; charset=utf-8",dataType:"JSON",headers:{Auth:login+":"+token},error:function(n,t,i){mensajeError=n.status+"\n"+n.responseText;"\n"+i;alertaErrorMin(mensajeError);CerrarCargando()},success:function(n){n.Error===0?(alertaExitoMin("TIEMPO ALMACENADO CON EXITO."),CargarTablaGestionC(Id_papeleta),idPaleta="0",paletaO="0",CerrarCargando()):(alertaErrorMin(n.Mensaje.toUpperCase()),CerrarCargando())}})}function IngresarGestionDelegado(){MostrarCargando();DatosG.Num_paleta=$("#numPapeleta").val();DatosG.Usuario=login;$.ajax({type:"POST",url:apiUrl+"/api/Asamblea/Gestion/IngresarGestion",data:JSON.stringify(DatosG),contentType:"application/json; charset=utf-8",dataType:"JSON",headers:{Auth:login+":"+token},error:function(n,t,i){mensajeError=n.status+"\n"+n.responseText;"\n"+i;alertaErrorMin(mensajeError);CerrarCargando()},success:function(n){n.Error===0?(alertaExitoMin(n.Mensaje.toUpperCase()),CargarTablaGestion(),$("#numPapeleta").val(""),CerrarCargando()):(alertaErrorMin(n.Mensaje.toUpperCase()),CerrarCargando())}})}function EliminarGestionDelegado(n){if(idPaleta===n){alertaError("Eliminar delegado"," No puede eliminar un delegado cuando el contador de tiempo ya se ha iniciado.");return}MostrarCargando();DatosG.Num_paleta=n;DatosG.Cedula=cedulaO;DatosG.Usuario=login;$.ajax({type:"POST",url:apiUrl+"/api/Asamblea/Gestion/EliminarGestionD",data:JSON.stringify(DatosG),contentType:"application/json; charset=utf-8",dataType:"JSON",headers:{Auth:login+":"+token},error:function(n,t,i){mensajeError=n.status+"\n"+n.responseText;"\n"+i;alertaError("Eliminar delegado de la gestión:",mensajeError);CerrarCargando()},success:function(n){n.Error===0?(alertaExito("Uso de la Palabra",n.Mensaje.toUpperCase()),CargarTablaGestion(),CerrarCargando()):(alertaError("Uso de la Palabra",n.Mensaje.toUpperCase()),CerrarCargando())}})}var tipo="D",reincidente="N",myInterval,objtabla=$("#tablaGestion"),tabla,clock,nombreReporte="Lista de Delegados",DatosG={Orden:0,Num_paleta:0,Cedula:"",Nombre:"",Usuario:"",Tiempo:"",Terminal:""},id_papeleta,paletaO,cedulaO,idPaleta,listaPaletas,SegDelegado1=180,SegDelegado2=120,SegCandidato=60;$(document).ready(function(){$(".card-title").removeClass("float");clock=$(".clock-1").FlipClock({clockFace:"MinuteCounter",language:"Spanish",autoPlay:!1,autoStart:!1});$("#modal-lg-tipo-gestion").modal({backdrop:"static",keyboard:!1},"show");$(document).on("click","#btnSeleccionar",function(){tipo=$("#selTipo").val();tipo==="D"?(CargarTablaGestion(),$("#btnPapeletas").remove()):($("#orden").text("Posición"),obtenerPapeletas(),$("#frmPaleta").remove());$("#modal-lg-tipo-gestion").modal("hide")});$(document).on("click","#btnCancelar",function(){redirect(paginaInicio)});$("#numPapeleta").on("keypress",function(n){if(n.keyCode===13){if($("#numPapeleta").val()==="0"||$("#numPapeleta").val()==="")return!1;var t=$("#numPapeleta").val();return jQuery.inArray(parseInt(t),listaPaletas)===-1?IngresarGestionDelegado():alertaInfoMin("LA PALETA YA EXISTE EN LA LISTA, PALETA: "+t),!1}});$(document).on("click","#btnIniciarT",function(){if(!tabla.data().any())return!1;idPaleta=$("#tablaGestion").children("tbody").children("tr:first").find("td:eq(0)").text();$("#btnIniciarT").prop("disabled",!0);$("#btnFinT").prop("disabled",!1);$(".btn-papeletas").prop("disabled",!0);$("#palabra").text("PALETA  "+$("#tablaGestion").children("tbody").children("tr:first").find("td:eq(0)").text()+" - ( "+$("#tablaGestion").children("tbody").children("tr:first").find("td:eq(2)").text()+" )");reincidente=$("#tablaGestion").children("tbody").children("tr:first").find("td:eq(0) p").attr("data-idR");paletaO=$("#tablaGestion").children("tbody").children("tr:first").find("td:eq(0) p").attr("data-idO");cedulaO=$("#tablaGestion").children("tbody").children("tr:first").find("td:eq(1)").text();tipo==="D"?reincidente==="N"?(myInterval=setInterval(function(){clock.getTime().time>=SegDelegado1&&$(".red").css("opacity","1")},1e3),clock.start(function(){})):(myInterval=setInterval(function(){clock.getTime().time>=SegDelegado2&&($(".red").css("opacity","1"),clearInterval(myInterval))},1e3),clock.start(function(){})):(myInterval=setInterval(function(){clock.getTime().time>=SegCandidato&&($(".red").css("opacity","1"),clearInterval(myInterval))},1e3),clock.start(function(){}));activarActivaDesactivaA("A",reincidente)});$(document).on("click","#btnFinT",function(){$("#palabra").text("Esperando...");$("#btnIniciarT").prop("disabled",!1);$(".btn-papeletas").prop("disabled",!1);$("#btnFinT").prop("disabled",!0);var n=clock.getTime().time;clock.stop(function(){});clock.reset(function(){});clearInterval(myInterval);tipo==="D"?ActualizarGestion(n):IngresarGestionC(n);activarActivaDesactivaA("D",reincidente)});$(document).on("click","#reset",function(){$("#palabra").text("Esperando...");$("#btnIniciarT").prop("disabled",!1);$(".btn-papeletas").prop("disabled",!1);$("#btnFinT").prop("disabled",!0);var n=clock.getTime();clock.stop(function(){});clock.reset(function(){});clearInterval(myInterval);activarActivaDesactivaA("D",reincidente)});$(document).on("click",".tooltipImgB",function(){var n=$(this).closest("tr").find("td:eq(0)").text(),t;cedulaO=$(this).closest("tr").find("td:eq(1)").text();t=$(this).closest("tr");Swal.close();Swal.fire({title:"Eliminar Datos",html:"¿Desea Eliminar la paleta <b>"+n+"<\/b> de la lista?",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:"Aceptar"}).then(function(i){i.value&&(tipo==="D"?EliminarGestionDelegado(n):t.remove())})})});