function IniciarModulo(n){iniciarDataTable(objtablaI,"Reporte de Entradas");iniciarDataTable(objtablaS,"Reporte de Salidas");validarPermisos();n()}function iniciarDataTable(n,t){n.DataTable({dom:"Bfrtip",buttons:[{extend:"excelHtml5",text:"EXCEL",exportOptions:{columns:[0,1,2,3,4]},title:function(){return t},sheetName:"Reporte Quorum",className:"btn-success ml-2"}],fnDrawCallback:function(){var t=n.DataTable();t.data().length===0?t.buttons(".buttons-excel").disable():t.buttons(".buttons-excel").enable()},bDestroy:!0,ordering:!1,bDeferRender:!0,paging:!1,scrollY:$(document).height()-556+"px",scrollX:!0,scrollCollapse:!0,scroller:!0,autoWidth:!1,responsive:!0,columns:[{width:"5%",sortable:!1,className:"textoCentrado"},{width:"15%",sortable:!1},{width:"44%",sortable:!1},{width:"5%",sortable:!1,className:"textoCentrado text-danger text-bold"},{width:"26%",sortable:!1},{width:"5%",sortable:!1,className:"textoCentrado"}]})}function TotalDFuncion(){$.ajax({type:"POST",url:apiUrl+"/api/Asamblea/Delegado/TotalDelegados",contentType:"application/json; charset=utf-8",dataType:"JSON",error:function(n,t,i){mensajeError=n.status+"\n"+n.responseText;"\n"+i;alertaError("Carga Total de Delegados",mensajeError);console.log(mensajeError);TotalD=0},success:function(n){TotalD=n;$("#tituloQ").html('QUORUM - TOTAL EN EL PADRÓN &nbsp;&nbsp; <span class="badge badge-danger">'+TotalD+"<\/span>")}})}function ValidarQ(){MostrarCargando();$.ajax({type:"POST",url:apiUrl+"/api/Asamblea/Quorum/ValidarQ",contentType:"application/json; charset=utf-8",dataType:"JSON",headers:{Auth:sessionStorage.Cedula+":"+sessionStorage.Token},error:function(n,t,i){mensajeError=n.status+"\n"+n.responseText;"\n"+i;alertaError("Validar Quorum",mensajeError);CerrarCargando()},success:function(n){n===1?($("#modal-lg-abri-quorum").modal({backdrop:"static",keyboard:!1},"show"),CerrarCargando()):n===2?(EjecutarCargaTablas(),setInterval(function(){CargarTablas("I");CargarTablas("S")},3e4)):alertaError("Validar Quorum","El código devuelto debe ser 1 = No hay Quorum abierto, 2 = Quorum Abierto. Código :"+n)}})}function RegistroIS(n){MostrarCargando();$("#bIngreso").removeClass("border-shine");$("#bSalida").removeClass("border-shine");var t={};t.cedula=n;t.usuario=sessionStorage.Cedula;$("#cedula").val("");$.ajax({type:"POST",url:apiUrl+"/api/Asamblea/Quorum/RegistrarIS",data:JSON.stringify(t),contentType:"application/json; charset=utf-8",dataType:"JSON",headers:{Auth:sessionStorage.Cedula+":"+sessionStorage.Token},error:function(n,t,i){mensajeError=n.status+"\n"+n.responseText;"\n"+i;alertaErrorMin(mensajeError);CerrarCargando()},success:function(t){t===1?(alertaExitoMin("ENTRADA REGISTRADA CORRECTAMENTE"),$("#bIngreso").addClass("border-shine"),EjecutarCargaTablas()):t===2?(alertaExitoMin2("SALIDA REGISTRADA CORRECTAMENTE"),$("#bSalida").addClass("border-shine"),EjecutarCargaTablas()):t===3?(alertaErrorMin("LA CÉDULA INGRESADA NO EXISTE "+n),CerrarCargando()):(alertaErrorMin("ERROR AL REGISTRAR, VERIFIQUE SI EXISTE UN QUORUM ABIERTO."),CerrarCargando())}})}function EjecutarCargaTablas(){setTimeout(function(){CargarTablas("I");CargarTablas("S");CerrarCargando()},1e3)}function CargarTablas(n){var t=0,i=0;$.ajax({type:"POST",url:apiUrl+"/api/Asamblea/Quorum/ListaQuorum",contentType:"application/json; charset=utf-8",dataType:"JSON",data:JSON.stringify(n),error:function(n,t,i){mensajeError=n.status+"\n"+n.responseText;"\n"+i;alertaError("Lista Quorum",mensajeError)},success:function(r){var u;if(n==="I"){CargarFilas(r,objtablaI);$("#tablaingreso tbody").on("click","tr",function(){$(this).hasClass("selected")||($("#tablaingreso tr.selected").removeClass("selected"),$(this).addClass("selected"))});u=objtablaI.DataTable();t=u.data().length;TotalIngresos=t;$("#tingresos").text(t);$("#TimeLT").html("&nbsp;<b>"+t+'<\/b>&nbsp;&nbsp;|&nbsp;&nbsp;<b class="text-danger">'+TotalD+"&nbsp;<b>");i=(t*100/TotalD).toFixed(0);$("#TimeLW").width(i+"%");$("#TimeLW").html('<b style="font-size: 20px; color: black">'+i+" %<\/b>")}else{CargarFilas(r,objtablaS);$("#tablasalida tbody").on("click","tr",function(){$(this).hasClass("selected")||($("#tablasalida tr.selected").removeClass("selected"),$(this).addClass("selected"))});u=objtablaS.DataTable();$("#tsalidas").text(u.data().length)}}})}function CargarFilas(n,t){if(t.dataTable().fnClearTable(),n.length>0){var i=[];n.map(function(n){i.push([n.Id_delegado,n.Cedula,n.Nombre,n.Num_paleta,n.F_ing_sal,'<img class="tooltipImgB" src="images/Iconos/delete.png" style="cursor:pointer" data-toggle="tooltip" title="Eliminar" />'])});t.dataTable().fnAddData(i,!0)}}function EliminarD(n){MostrarCargando();$.ajax({type:"POST",url:apiUrl+"/api/Asamblea/Quorum/EliminarD",contentType:"application/json; charset=utf-8",dataType:"JSON",headers:{Auth:sessionStorage.Cedula+":"+sessionStorage.Token},data:JSON.stringify(n),error:function(n,t,i){mensajeError=n.status+"\n"+n.responseText;"\n"+i;alertaError("Eliminar registro de Quorum",mensajeError);CerrarCargando()},success:function(n){n.Error===0?(alertaExitoMin("Delegado eliminado Correctamente."),EjecutarCargaTablas()):(alertaErrorMin(n.Mensaje),CerrarCargando())}})}function AbrirQ(){MostrarCargando();$.ajax({type:"POST",url:apiUrl+"/api/Asamblea/Quorum/AbrirQ",contentType:"application/json; charset=utf-8",dataType:"JSON",data:JSON.stringify(sessionStorage.Cedula),headers:{Auth:sessionStorage.Cedula+":"+sessionStorage.Token},error:function(n,t,i){mensajeError=n.status+"\n"+n.responseText;"\n"+i;alertaError("Abrir Quorum",mensajeError);CerrarCargando()},success:function(n){n.Error===0?EjecutarCargaTablas():(alertaErrorMin(n.Mensaje),CerrarCargando())}})}function CerrarQ(){MostrarCargando();$.ajax({type:"POST",url:apiUrl+"/api/Asamblea/Quorum/CerrarQ",contentType:"application/json; charset=utf-8",dataType:"JSON",data:JSON.stringify(sessionStorage.Cedula),headers:{Auth:sessionStorage.Cedula+":"+sessionStorage.Token},error:function(n,t,i){mensajeError=n.status+"\n"+n.responseText;"\n"+i;alertaError("Cerrar Quorum",mensajeError);CerrarCargando()},success:function(n){n.Error===0?(alertaExitoMin("Quorum cerrado Correctamente."),EjecutarCargaTablas()):(alertaErrorMin(n.Mensaje),CerrarCargando())}})}function crearGrafico(){limpiarGraficos();etiquetas_Graf1.push("PRESENTES");etiquetas_Graf1.push("AUSENTES");var n=TotalIngresos,t=TotalD-TotalIngresos;datos_Graf1.push(n);datos_Graf1.push(t);$("#lbl_title").html('<i class="fas fa-square text-success mr-2"><\/i><b style="font-size: 30px;">ESTADO QUORUM - TOTAL EN PADRÓN:<\/b> <b style="font-size: 30px;" class="text-danger ml-2">'+TotalD+"<\/b>");cargarGraficoBar("ctxGrafico2","pie",datos_Graf1,etiquetas_Graf1)}function cargarGraficoBar(n,t,i,r){$("#"+n).remove();$("."+n).append('<canvas id="'+n+'" width="400" height="240"><\/canvas>');var u=document.getElementById(n).getContext("2d"),f=new Chart(u,{type:t,data:{labels:r,datasets:[{label:"CANTIDAD DE REGISTROS",data:i,borderWidth:2,backgroundColor:["rgba(48, 203, 0, 0.2)","rgba(241, 130, 141,1)"],borderColor:["rgba(48, 203, 0, 1)","rgba(217, 30, 24, 1)"]}]},options:{scales:{yAxes:[{ticks:{beginAtZero:!0,fontColor:"black",fontSize:20}}],xAxes:[{ticks:{min:0,stepSize:10,fontColor:"black",fontSize:30}}]}}})}function limpiarGraficos(){datos_Graf1.length=0;etiquetas_Graf1.length=0}function validarPermisos(){$("#content .fa-lock").remove();ValidarPermisoCRUD("CQ")?"":$("#btnCerrarQ").append('<span class="fa fa-lock pl-2"><\/span>');ValidarPermisoCRUD("AQ")?"":$("#btnAceptar").append('<span class="fa fa-lock text-danger pl-2"><\/span>');ValidarPermisoCRUD("D")?"":$(".TblDelete").append('<span class="fa fa-lock text-danger"><\/span>')}var apiUrl=sessionStorage.Uri,objtablaI=$("#tablaingreso"),objtablaS=$("#tablasalida"),TotalD,etiquetas_Graf1=[],datos_Graf1=[],TotalIngresos,IntervalGrafico;Chart.plugins.register(ChartDataLabels);Chart.helpers.merge(Chart.defaults.global.plugins.datalabels,{align:"end",anchor:"center",clamp:!0,color:"black",labels:{title:{font:{weight:"bold"}}},backgroundColor:function(n){return n.dataset.backgroundColor},borderColor:"darkred",borderRadius:25,borderWidth:2,font:{size:35,weight:"bold"}});$(document).ready(function(){IniciarModulo(ValidarQ);TotalDFuncion();$(document).on("click","#btnRegistrar",function(){var n=$("#cedula").val();if(n==="0"||$.trim(n)==="")return!1;RegistroIS($.trim($("#cedula").val()))});$("#cedula").on("keypress",function(n){if(n.keyCode===13){if($(this).val()==="0"||$.trim($(this).val())==="")return!1;RegistroIS($.trim($("#cedula").val()))}});$(document).on("click",".tooltipImgB",function(){if(ValidarPermisoCRUD("D")){var n=$(this).closest("tr").find("td:eq(1)").text();Swal.close();Swal.fire({title:"Eliminar Datos",html:"¿Desea Eliminar el usuario <b>"+n+"<\/b>?",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:"Aceptar"}).then(function(t){t.value&&EliminarD(n)})}else mensajeBloqueoToast()});$(document).on("click","#btnAceptar",function(){ValidarPermisoCRUD("AQ")?(AbrirQ(),$("#modal-lg-abri-quorum").modal("hide")):mensajeBloqueoToast()});$(document).on("click","#btnCerrarQ",function(){ValidarPermisoCRUD("CQ")?(Swal.close(),Swal.fire({title:"Cerrar Quorum",html:"¿Desea cerrar el Quorum?",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:"Aceptar"}).then(function(n){n.value&&CerrarQ()})):mensajeBloqueoToast()});$(document).on("click","#btnRefrescar",function(){location.reload(!0)});$(document).on("click","#btnGrafico",function(){$("#modal_gradico").modal("show");crearGrafico();IntervalGrafico=setInterval(function(){crearGrafico()},35e3)});$("#modal_gradico").on("hidden.bs.modal",function(){clearInterval(IntervalGrafico)})});