function accionesIniciales(){$("#btn_detalle_resultado").attr("disabled",!0);$("#btn_descargar_pdf").attr("disabled",!0);$(".btn-papeletas").attr("disabled",!0);$("#modal_inicial").modal("show")}function obtenerElecciones(){$.ajax({type:"POST",url:apiUrl+"/api/Asamblea/Eleccion/ListadoElecciones",contentType:"application/json; charset=utf-8",dataType:"JSON",error:function(n,t,i){mensajeError=n.status+"\n"+n.responseText;"\n"+i;alertaError("Carga de Elecciones",mensajeError)},success:function(n){$("#modalEleccion").empty();n.map(function(n){$("#modalEleccion").append('<option value="'+n.Id_eleccion+'">'+n.Nombre+"<\/option>")});obtenerRondas()}})}function obtenerRondas(){Id_eleccion=$("#modalEleccion").val();$(Id_eleccion!=="0")&&(DatosER.Id_eleccion=Id_eleccion,$.ajax({type:"POST",url:apiUrl+"/api/Asamblea/EleccionRonda/ListadoEleccionesR",data:JSON.stringify(DatosER),contentType:"application/json; charset=utf-8",error:function(n,t,i){mensajeError=n.status+"\n"+n.responseText;"\n"+i;alertaError("Carga roles",mensajeError)},success:function(n){$("#modalRonda").empty();n.map(function(n){$("#modalRonda").append('<option value="'+n.Id_ronda+'">'+n.Nombre+"<\/option>")})}}))}function iniciarDataTable(){tabla=objTabla.DataTable({dom:"Bfrtip",buttons:[{extend:"excelHtml5",text:"EXCEL",exportOptions:{columns:[0,1,2,3,4,5],stripHtml:!1},title:"Resultados Resumen",sheetName:"Resultados Resumen",className:"btn-success mr-2"},{extend:"pdfHtml5",text:"PDF",pageSize:"A4",exportOptions:{columns:[0,1,2,3,4,5],stripHtml:!1},className:"btn-danger"}],fnDrawCallback:function(){var n=objTabla.DataTable();n.data().length===0?n.buttons(".buttons-html5").disable():n.buttons(".buttons-html5").enable();var t=this.api(),r=t.rows({page:"current"}).nodes(),i=null;t.column(0,{page:"current"}).data().each(function(n,t){i!==n&&($(r).eq(t).before('<tr class="group"><td colspan="10" style="text-align: center;" >'+n+"<\/td><\/tr>"),i=n)})},initComplete:function(){$(".dataTables_scrollBody thead tr").css({visibility:"collapse"})},aaSorting:[[0,"asc"],[5,"asc"]],bDestroy:!0,bDeferRender:!0,paging:!1,scrollY:$(document).height()-380+"px",scrollCollapse:!0,scroller:!0,bSort:!0,autoWidth:!0,responsive:!0,aoColumns:[{className:"text-center"},{className:"text-center",bSearchable:!1},{bSearchable:!1},{render:function(n){return"<div><img src='../Images/Candidatos/"+n+"' style='width:50%' /><\/div>"},className:"text-center",bSortable:!1,bSearchable:!1},{className:"text-center",bSearchable:!1},{className:"text-center text-danger text-bold",bSearchable:!1}]})}function validarDatosPantalla(){return $("#modalEleccion").val()===undefined||$("#modalEleccion").val()===null?(alertaError("CONTROL DE DATOS","Seleccione una ELECCIÓN de la lista."),1):$("#modalRonda").val()===undefined||$("#modalRonda").val()===null?(alertaError("CONTROL DE DATOS","Selecciones una RONDA de la lista."),1):0}function IniciarCargaInterfaz(){obtenerPapeletas();Id_papeleta===undefined?Toast.fire({toast:!1,type:"info",title:"CARGA DE RESULTADOS",html:"<h5>No hay resultados registrados para la <b>Elección: <\/b>"+$("#modalEleccion").text()+" | <b>Ronda : <\/b>"+$("#modalRonda option:selected").text()+"<\/h5>",allowOutsideClick:!0,confirmButtonColor:"#3085d6",confirmButtonText:"Aceptar"}).then(function(n){n.value&&$("#modal_inicial").modal("show")}):($("#btn_detalle_resultado").attr("disabled",!1),$("#btn_descargar_pdf").attr("disabled",!1),$(".btn-papeletas").attr("disabled",!1),iniciarCarga())}function obtenerPapeletas(){var n={Id_eleccion:Id_eleccion,Id_ronda:Id_ronda};$.ajax({type:"POST",async:!1,url:apiUrl+"/api/Asamblea/PapeletaRonda/ListadoPapeletasR",data:JSON.stringify(n),contentType:"application/json; charset=utf-8",dataType:"JSON",error:function(n,t,i){mensajeError=n.status+"\n"+n.responseText;"\n"+i;alertaError("Carga papeletas",mensajeError)},success:function(n){if(n!==null&&n.length>0){Id_papeleta=n[0].Id_papeleta;Nombre_papeleta=n[0].Id_papeleta+" - "+n[0].Nombre;$(".card-titulo").html('RESUMEN DE RESULTADOS  ( <b class="text-danger"> '+n[0].Id_papeleta+" - "+n[0].Nombre+" <\/b>)");var t=[];$.each(n,function(n,i){var r=$('<span id="'+i.Id_papeleta+'" class="dropdown-item">'+i.Id_papeleta+" - "+i.Nombre+'<\/span><div class="dropdown-divider"><\/div>');t.push(r)});$("#listaPapeletas").append(t);$(".dropdown-item").click(function(n){n.preventDefault();var t=$(this).text(),i=$(this).attr("id");Id_papeleta=i;Nombre_papeleta=t;$(".card-titulo").html('RESUMEN DE RESULTADOS  ( <b class="text-danger"> '+t+" <\/b>)");iniciarCarga()})}}})}function iniciarCarga(){obtenerResultados();cargarGraficoBar("ctxGrafico1","horizontalBar",datos_Graf1,etiquetas_Graf1);cargarGraficoBar("ctxGrafico2","pie",datos_Graf2,etiquetas_Graf2)}function obtenerResultados(){var n={},t;n.Id_eleccion=Id_eleccion;n.Id_ronda=Id_ronda;n.Id_papeleta=Id_papeleta;n.Usuario=Login;t=JSON.stringify({parametros:n});$.ajax({type:"POST",url:apiUrl+"/api/Resultado/ResultadoResumen",data:t,async:!1,contentType:"application/json; charset=utf-8",dataType:"JSON",headers:{Auth:sessionStorage.Cedula+":"+sessionStorage.Token},error:function(n,t,i){mensajeError=n.status+"\n"+n.responseText;"\n"+i;alertaError("Carga de Elecciones",mensajeError)},success:function(n){var i,r,t;if(n===undefined||n===null)Toast.fire({toast:!1,type:"info",title:"CARGA DE RESULTADOS",html:"<h5>No hay resultados registrados en la base de datos.<\/h5>",allowOutsideClick:!0,confirmButtonColor:"#3085d6",confirmButtonText:"Aceptar"}).then(function(n){n.value&&$("#modal_inicial").modal("show")});else for(i=0,r=0,limpiarGraficos(),t=0;t<n.length;t++)n[t].Cedula!=="0"?(i+=n[t].Votos,etiquetas_Graf1.push([n[t].Num_posicion]+" - "+[n[t].Nombre]),datos_Graf1.push([n[t].Votos])):r+=n[t].Votos;etiquetas_Graf2.push("VOTOS EMITIDOS");etiquetas_Graf2.push("VOTOS EN BLANCO");datos_Graf2.push(i);datos_Graf2.push(r);$(".txt_total_efectivos").html('<i class="fas fa-square text-success mr-2"><\/i><b>VOTOS EMITIDOS:<\/b> <b style="font-size: 20px;" class="text-danger ml-2">'+i+"<\/b>");$(".txt_total_todos").html('<i class="fas fa-square text-success mr-2"><\/i><b>VOTOS TOTALES:<\/b> <b style="font-size: 20px;" class="text-danger ml-2">'+(i+r)+"<\/b>")}})}function limpiarGraficos(){datos_Graf1.length=0;datos_Graf2.length=0;etiquetas_Graf1.length=0;etiquetas_Graf2.length=0}function cargarResultadosDetalle(){var n={},t;n.Id_eleccion=Id_eleccion;n.Id_ronda=Id_ronda;n.Id_papeleta=0;n.Usuario=Login;t=JSON.stringify({parametros:n});$.ajax({type:"POST",url:apiUrl+"/api/Resultado/ResultadoResumen",data:t,contentType:"application/json; charset=utf-8",dataType:"JSON",headers:{Auth:sessionStorage.Cedula+":"+sessionStorage.Token},error:function(n,t,i){mensajeError=n.status+"\n"+n.responseText;"\n"+i;alertaError("Carga de Elecciones",mensajeError)},success:function(n){n===undefined||n===null?Toast.fire({toast:!1,type:"info",title:"CARGA DE RESULTADOS",html:"<h5>No hay resultados registrados en la base de datos.<\/h5>",allowOutsideClick:!0,confirmButtonColor:"#3085d6",confirmButtonText:"Aceptar"}).then(function(n){n.value&&$("#modal_inicial").modal("show")}):agregarFilasDT(n)}})}function agregarFilasDT(n){var i,t;for(objTabla.dataTable().fnClearTable(),i=[],t=0;t<n.length;t++)i.push([n[t].Papeleta,n[t].Id_candidato,n[t].Nombre,n[t].Foto,n[t].Votos,n[t].Posicion]);objTabla.dataTable().fnAddData(i,!1);tabla.draw()}function cargarGraficoBar(n,t,i,r){$("#"+n).remove();$("."+n).append('<canvas id="'+n+'" width="400" height="300"><\/canvas>');var u=document.getElementById(n).getContext("2d"),f=new Chart(u,{type:t,data:{labels:r,datasets:[{label:"CANTIDAD DE VOTOS",data:i,borderWidth:2,backgroundColor:["rgba(48, 203, 0, 0.2)","rgba(54, 162, 235, 0.2)","rgba(255, 206, 86, 0.2)","rgba(75, 192, 192, 0.2)","rgba(153, 102, 255, 0.2)","rgba(255, 159, 64, 0.2)"],borderColor:["rgba(48, 203, 0, 1)","rgba(54, 162, 235, 1)","rgba(255, 206, 86, 1)","rgba(75, 192, 192, 1)","rgba(153, 102, 255, 1)","rgba(255, 159, 64, 1)"]}]},options:{scales:{yAxes:[{ticks:{beginAtZero:!0,fontColor:"black"}}],xAxes:[{ticks:{min:0,stepSize:1,fontColor:"black"}}]}}})}const Toast=Swal.mixin({position:"center"});Chart.plugins.register(ChartDataLabels);Chart.helpers.merge(Chart.defaults.global.plugins.datalabels,{align:"end",anchor:"center",clamp:!0,color:"black",labels:{title:{font:{weight:"bold"}}},backgroundColor:function(n){return n.dataset.backgroundColor},borderColor:"darkred",borderRadius:25,borderWidth:2,font:{size:16,weight:"bold"}});var tabla,dataReportes,objTabla=$("#tbl_tabla"),apiUrl=sessionStorage.Uri,Id_eleccion,Id_ronda,Login,Id_papeleta,Nombre_papeleta,etiquetas_Graf1=[],datos_Graf1=[],etiquetas_Graf2=[],datos_Graf2=[],DatosER={Id_eleccion:"",Id_ronda:"",Nombre:"",Descripcion:"",F_inicio:"",F_final:"",I_estado:"",Usuario:"",Terminal:""};$(document).ready(function(){accionesIniciales();obtenerElecciones();iniciarDataTable();$(document).on("click","#btnGuardar",function(){validarDatosPantalla()!==1&&Toast.fire({toast:!1,type:"warning",title:"CARGA DE RESULTADOS",html:"<h5>Está seguro de su selección ?<\/h5>",allowOutsideClick:!1,showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:"Aceptar"}).then(function(n){if(n.value)Id_eleccion=$("#modalEleccion").val(),Id_ronda=$("#modalRonda").val(),Login=sessionStorage.getItem("Cedula"),IniciarCargaInterfaz(),$("#modal_inicial").modal("hide");else return})});$(document).on("click","#btn_detalle_resultado",function(n){n.preventDefault();$("#modal_detalle").modal("show")});$(document).on("click","#btnRefrescar",function(){location.reload(!0)});$("#btn_descargar_pdf").click(function(){domtoimage.toPng(document.getElementById("content")).then(function(n){var t=new jsPDF("l","pt",[$("#content").width(),$("#content").height()]),i;t.addImage(n,"PNG",0,0,$("#content").width(),$("#content").height());i="Resultados_E_"+Id_eleccion+"_R_"+Id_eleccion+"_P_"+Nombre_papeleta+".pdf";t.save(i)})});$(document).on("shown.bs.modal","#modal_detalle",function(){cargarResultadosDetalle()});$(document).on("shown.bs.modal","#modal_inicial",function(){if($("#modal_inicial").is(":visible"))$("#modal_inicial").on("keypress",function(n){console.log(n.which);n.which===13&&$("#btnGuardar").click()})})});