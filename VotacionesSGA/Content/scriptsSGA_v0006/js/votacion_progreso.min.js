function obtenerElecciones(){$.ajax({type:"POST",url:apiUrl+"/api/Asamblea/Eleccion/ListadoElecciones",contentType:"application/json; charset=utf-8",dataType:"JSON",error:function(n,t,i){mensajeError=n.status+"\n"+n.responseText;"\n"+i;alertaError("Carga de Elecciones",mensajeError)},success:function(n){$("#modalEleccion").empty();n.map(function(n){$("#modalEleccion").append('<option value="'+n.Id_eleccion+'">'+n.Nombre+"<\/option>")});obtenerRondas()}})}function obtenerRondas(){if(Id_eleccion=$("#modalEleccion").val(),$(Id_eleccion!=="0")){DatosER.Id_eleccion=Id_eleccion;var n=JSON.stringify({DatosER});$.ajax({type:"POST",url:apiUrl+"/api/Asamblea/EleccionRonda/ListaRondasPorEleccion",data:n,contentType:"application/json; charset=utf-8",error:function(n,t,i){mensajeError=n.status+"\n"+n.responseText;"\n"+i;alertaError("Carga de Rondas",mensajeError)},success:function(n){$("#modalRonda").empty();n.map(function(n){$("#modalRonda").append('<option value="'+n.Id_ronda+'">'+n.Nombre+"<\/option>")})}})}}function iniciarDataTable(){tabla=objTabla.DataTable({dom:"Bfrtip",buttons:[{extend:"excelHtml5",text:"EXCEL",exportOptions:{columns:[0,1,2,3,4,5,6,7,8,9,10],stripHtml:!0},title:"Votaciones Progreso",sheetName:"Votaciones Progreso",className:"btn-success mr-2"},{extend:"pdfHtml5",text:"PDF",pageSize:"A4",exportOptions:{columns:[0,1,2,3,4,5,6,7,8,9,10],stripHtml:!0},className:"btn-danger"}],fnDrawCallback:function(){var n=objTabla.DataTable();n.data().length===0?n.buttons(".buttons-html5").disable():n.buttons(".buttons-html5").enable()},initComplete:function(){$(".dataTables_scrollBody thead tr").css({visibility:"collapse"})},bDestroy:!0,ordering:!0,bDeferRender:!0,paging:!1,scrollY:$(document).height()-348+"px",scrollCollapse:!0,scroller:!0,bSort:!0,autoWidth:!0,responsive:!0,aoColumns:[{className:"text-center"},{className:"text-center"},{width:"20%",className:"text-center"},{className:"text-center"},{className:"text-center"},{className:"text-center"},{className:"text-center"},{className:"text-center"},{className:"text-center"},{className:"text-center"},{className:"text-center",bSortable:!1}]})}function validarDatosPantalla(){return $("#modalSegundos").val()<5||$("#modalSegundos").val()>60?(alertaError("CONTROL DE DATOS","Seleccione un intervalo de actualización entre 5 y 60 segundos."),1):$("#modalEleccion").val()===undefined||$("#modalEleccion").val()===null?(alertaError("CONTROL DE DATOS","Seleccione una ELECCIÓN de la lista."),1):$("#modalRonda").val()===undefined||$("#modalRonda").val()===null?(alertaError("CONTROL DE DATOS","Selecciones una RONDA de la lista."),1):0}function cargarResultados(){var n={},t;n.Id_eleccion=Id_eleccion;n.Id_ronda=Id_ronda;n.Usuario=Login;t=JSON.stringify({parametros:n});$.ajax({type:"POST",url:apiUrl+"/api/Resultado/ResultadoProgreso",data:t,async:!0,contentType:"application/json; charset=utf-8",dataType:"JSON",headers:{Auth:sessionStorage.Cedula+":"+sessionStorage.Token},error:function(n,t,i){mensajeError=n.status+"\n"+n.responseText;"\n"+i;alertaError("Carga de Resultados",mensajeError)},success:function(n){if(n.length===0)clearInterval(refresh_Interval_TablaId),Toast.fire({toast:!1,type:"info",title:"CARGA DE REGISTROS",html:"<h5>No existen registros de votaciones en progreso para <b>Elección: <\/b>"+$("#modalEleccion").text()+" | <b>Ronda : <\/b>"+$("#modalRonda option:selected").text()+"<\/h5>",allowOutsideClick:!0,confirmButtonColor:"#3085d6",confirmButtonText:"Aceptar"}).then(function(n){n.value&&$("#modal_inicial").modal("show")});else{var t=n.length,i=contadorFinalizados(n,"FINALIZADO");$(".card-titulo").html('<i class="fas fa-square text-success mr-2"><\/i><b>PROGRESO DE VOTACIONES  ( TOTAL : <\/b> <b style="font-size: 20px;" class="text-danger ml-2">'+t+'<\/b> |  FINALIZADO: <b style="font-size: 20px;" class="text-danger ml-2">'+i+"<\/b> )");agregarFilasDT(n)}}})}function agregarFilasDT(n){var i,t,r;for(objTabla.dataTable().fnClearTable(),i=[],t=0;t<n.length;t++)i.push([n[t].Id_delegado,n[t].Login,n[t].Nombre,n[t].Telefono,n[t].Papeletas,n[t].Votos,n[t].F_inicio_voto,n[t].F_fin_voto,n[t].Duracion,spanEstado(n[t].Progreso),n[t].Sesion_act]);if(objTabla.dataTable().fnAddData(i,!1),tabla.draw(),$("#btnRefrescar").length===0){r='<button type="button" class="btn  bg-gradient-secondary" id="btnRefrescar" style="margin-left:8px;">Refrescar<\/button>';$(".buttons-pdf").after(r);$(document).on("click","#btnRefrescar",function(){location.reload(!0)})}}function spanEstado(n){switch(n){case"VOTANDO":return'<small class="badge badge-success">'+n+"<\/small>";case"FINALIZADO":return'<small class="badge badge-danger">'+n+"<\/small>";default:return'<small class="badge badge-info">'+n+"<\/small>"}}function contadorFinalizados(n,t){var i=0;return $.each(n,function(n,r){r.Progreso===t&&i++}),i}const Toast=Swal.mixin({position:"center"});var tabla,dataReportes,objTabla=$("#tbl_tabla"),refresh_Interval_TablaId,apiUrl=sessionStorage.Uri,Segundos,Id_eleccion,Id_ronda,Login,DatosER={};$(document).ready(function(){$("#modal_inicial").modal("show");obtenerElecciones();iniciarDataTable();$(document).on("click","#btnGuardar",function(){validarDatosPantalla()!==1&&Toast.fire({toast:!1,type:"warning",title:"VOTACIÓN EN PROGRESO",html:"<h5>Está seguro de su selección ?<\/h5>",allowOutsideClick:!1,showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:"Aceptar"}).then(function(n){n.value&&(Segundos=$("#modalSegundos").val()*1e3,Id_eleccion=$("#modalEleccion").val(),Id_ronda=$("#modalRonda").val(),Login=sessionStorage.getItem("Cedula"),cargarResultados(),refresh_Interval_TablaId=setInterval(function(){cargarResultados()},Segundos),$("#modal_inicial").modal("hide"))})});$(document).on("shown.bs.modal","#modal_inicial",function(){$("#modalSegundos").focus();$("#modal_inicial").on("keypress",function(n){n.which===13&&$("#btnGuardar").click()})})});