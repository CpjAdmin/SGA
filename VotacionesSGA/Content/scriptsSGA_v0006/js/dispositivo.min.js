function CargarTablaDispositivos(){MostrarCargando();$.ajax({type:"POST",url:apiUrl+"/api/login/Dispositivo/ListaDispositivos",contentType:"application/json; charset=utf-8",dataType:"JSON",error:function(n,t,i){mensajeError=n.status+"\n"+n.responseText;"\n"+i;alertaError("Seleccionar Usuarios",mensajeError);CerrarCargando()},success:function(n){CargarFilas(n);CerrarCargando()}})}function spanEstado(n){return n==="A"?'<small class="badge badge-success">Activo<\/small>':'<small class="badge badge-danger">Inactivo<\/small>'}function CargarFilas(n){var t=[],i;n.map(function(n){t.push([n.Id_dispositivo,n.Nombre,n.Descripcion,n.Telefono,spanEstado(n.I_estado),'<img class="tooltipImgM" src="images/Iconos/update.png" style="cursor:pointer" data-toggle="tooltip" title="Modificar" />','<img class="tooltipImgB" src="images/Iconos/delete.png" style="cursor:pointer" data-toggle="tooltip" title="Eliminar" />'])});tabla=objtabla.DataTable({data:t,dom:"Bfrtip",buttons:[{extend:"excelHtml5",text:"EXCEL",exportOptions:{columns:[0,1,2,3,4]},title:function(){return"Reporte_dispositivos"},sheetName:"Reporte",className:"btn-success"}],columns:[{width:"5%",className:"textoCentrado"},null,null,null,{className:"textoCentrado"},{width:"5%",sortable:!1,className:"textoCentrado"},{width:"5%",sortable:!1,className:"textoCentrado"}],paging:!0,lengthChange:!1,searching:!0,ordering:!0,info:!0,pageLength:22,autoWidth:!1,destroy:!0,deferRender:!0,scrollY:$(document).height()-390+"px"});tabla.draw();$(".btn-group").width("20%");i='<button type="button" class="btn bg-gradient-primary" id="btnAgregar" style="margin-right:8px;">NUEVO DISPOSITIVO<\/button>';$(".buttons-excel").before(i);$("#tablaDispositivos tbody").on("click","tr",function(){$(this).hasClass("selected")||(tabla.$("tr.selected").removeClass("selected"),$(this).addClass("selected"))})}function GuardarDatos(){MostrarCargando();var n={};n.Nombre=$("#nombreD").val();n.Descripcion=$("#descripcionD").val();n.Telefono=$("#telefonoD").val();n.I_estado=$("#chkactivoD").is(":checked")?"A":"I";n.User_creacion=sessionStorage.Cedula;$.ajax({type:"POST",url:apiUrl+"/api/Asamblea/Dispositivo/InsertarDispositivo",data:JSON.stringify(n),contentType:"application/json; charset=utf-8",dataType:"JSON",headers:{Auth:sessionStorage.Cedula+":"+sessionStorage.Token},error:function(n,t,i){mensajeError=n.status+"\n"+n.responseText;"\n"+i;alertaErrorMin(mensajeError);CerrarCargando()},success:function(n){n.Error===0?(alertaExito("Guardar datos","Datos Guardados correctamente"),CargarTablaDispositivos(),CerrarCargando()):(alertaError("Guardar datos",n.Mensaje),CerrarCargando())}})}function ModificarDatos(){MostrarCargando();var n={};n.Id_dispositivo=$("#idD").val();n.Nombre=$("#nombreD").val();n.Descripcion=$("#descripcionD").val();n.Telefono=$("#telefonoD").val();n.I_estado=$("#chkactivoD").is(":checked")?"A":"I";n.User_creacion=sessionStorage.Cedula;$.ajax({type:"POST",url:apiUrl+"/api/Asamblea/Dispositivo/ModificarDispositivo",data:JSON.stringify(n),contentType:"application/json; charset=utf-8",dataType:"JSON",headers:{Auth:sessionStorage.Cedula+":"+sessionStorage.Token},error:function(n,t,i){mensajeError=n.status+"\n"+n.responseText;"\n"+i;alertaErrorMin(mensajeError);CerrarCargando()},success:function(n){n.Error===0?(alertaExito("Modificar datos","Datos Modificados correctamente"),CargarTablaDispositivos(),CerrarCargando()):(alertaError("Modificar datos",n.Mensaje),CerrarCargando())}})}function EliminarDatos(n){MostrarCargando();var t={};t.Id_dispositivo=n;t.User_creacion=sessionStorage.Cedula;$.ajax({type:"POST",url:apiUrl+"/api/Asamblea/Dispositivo/EliminarDispositivo",data:JSON.stringify(t),contentType:"application/json; charset=utf-8",dataType:"JSON",headers:{Auth:sessionStorage.Cedula+":"+sessionStorage.Token},error:function(n,t,i){mensajeError=n.status+"\n"+n.responseText;"\n"+i;alertaErrorMin(mensajeError);CerrarCargando()},success:function(n){n.Error===0?(alertaExito("Eliminar datos","Datos Eliminados correctamente"),CargarTablaDispositivos(),CerrarCargando()):(alertaError("Eliminar datos",n.Mensaje),CerrarCargando())}})}function validarDatosPantalla(){return $("#nombreD").val().length<5?(alertaError("Datos Dispositivo","El nombre debe ser mayor a 4 caracteres"),1):$.trim($("#telefonoD").val()).length<8?(alertaError("Datos Dispositivo","La descripción abreviada de la pantalla debe ser de 8 caracteres"),1):0}function GuardarModificar(n){n==="guardar"?GuardarDatos():ModificarDatos()}var apiUrl=sessionStorage.Uri,objtabla=$("#tablaDispositivos"),tabla;$(document).ready(function(){CargarTablaDispositivos();$(document).on("click","#btnAgregar",function(){$("#modal-lg-dispositivo").data("tipo","guardar");$("#modal-lg-dispositivo").modal("show");$("#lblDispositivo").text("NUEVO DISPOSITIVO");$("#idR").removeAttr("disabled");$("#idD").val("0");$("#nombreD").val("");$("#descripcionD").val("");$("#telefonoD").val("");$("#chkactivo").prop("checked",!0).change()});$(document).on("click",".tooltipImgM",function(){var n=$(this).closest("tr").find("td:eq(0)").text(),t=$(this).closest("tr").find("td:eq(1)").text(),i=$(this).closest("tr").find("td:eq(2)").text(),r=$(this).closest("tr").find("td:eq(3)").text(),u=$(this).closest("tr").find("td:eq(4)").text();$("#modal-lg-dispositivo").data("tipo","modificar");$("#modal-lg-dispositivo").modal("show");$("#lblDispositivo").text("MODIFICAR DISPOSITIVO");$("#idD").prop("disabled",!0);$("#idD").val(n);$("#nombreD").val(t);$("#descripcionD").val(i);$("#telefonoD").val(r);u==="Activo"?$("#chkactivoD").prop("checked",!0).change():$("#chkactivoD").prop("checked",!1).change()});$(document).on("click",".tooltipImgB",function(){var n=$(this).closest("tr").find("td:eq(0)").text();Swal.close();Swal.fire({title:"Eliminar Datos",html:"¿Desea Eliminar el dispositivo <b>"+n+"<\/b>?",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:"Aceptar"}).then(function(t){t.value&&EliminarDatos(n)})});$(document).on("click","#btnGuardar",function(){validarDatosPantalla()!==1&&(Swal.close(),Swal.fire({title:"Guardar Datos",text:"¿Desea guardar los datos?",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:"Aceptar"}).then(function(n){n.value&&($("#modal-lg-dispositivo").modal("hide"),GuardarModificar($("#modal-lg-dispositivo").data("tipo")))}))})});