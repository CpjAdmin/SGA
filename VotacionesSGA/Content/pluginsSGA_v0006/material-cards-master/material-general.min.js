function InicializarVariables(n){Contador_papeletas=parseInt(sessionStorage.getItem("Contador_papeletas"));Login=sessionStorage.getItem("Cedula");Cedula=sessionStorage.getItem("Cedula");Id_usuario=sessionStorage.getItem("Id");Id_delegado=sessionStorage.getItem("Id_delegado");Clave=sessionStorage.getItem("Clave");Uri=sessionStorage.getItem("Uri");Id_eleccion=parseInt(sessionStorage.getItem("Id_eleccion"));Id_ronda=parseInt(sessionStorage.getItem("Id_ronda"));Id_papeleta=parseInt(sessionStorage.getItem("Id_papeleta"));Num_papeletas=parseInt(sessionStorage.getItem("Num_papeletas"));Num_votos=parseInt(sessionStorage.getItem("Num_votos"));Id_voto_blanco=sessionStorage.getItem("Id_voto_blanco");Nombre_papeleta=sessionStorage.Nombre_papeleta;Color_papeleta=sessionStorage.Color_background;mostrarModal("modalCargando",Nombre_papeleta);AlistarFormulario(Nombre_papeleta,Num_votos,Color_papeleta);n()}function AlistarFormulario(n,t,i){$("#card-titulo").text(n);var r=$('<li class="nav-item"><\/li>'),u=$('<a class="text-danger text-bold">&nbsp;VOTOS DISPONIBLES :<\/a><span class="circulo" id="VTDisponibles" style="font-size: 1.1em;">'+t+"<\/span>");u.appendTo(r);r.appendTo("#nav-header");$(".content").css("background-color",i)}function CargarCandidatos(){AjaxCargarCandidatos(AccionesCargaCandidatos)}function AjaxCargarCandidatos(n){var t=Uri+"/api/candidato/"+Id_eleccion+"/"+Id_ronda+"/"+Id_papeleta;$.ajax({url:t,method:"GET",async:!0,contentType:"application/json",dataType:"json",success:function(t){t.length===0?swalWithBootstrapButtons.fire({title:"PAPELETA #"+Id_papeleta,html:"<h4>No existen candidatos asociados a esta papeleta.<\/h4>",type:"info",confirmButtonText:"VOLVER"}):(ListaCandidatos=[],$.each(t,function(n,t){var i=$('<div class="col-lg-5 col-md-4 col-sm-6 col-xs-12"><\/div>'),r=$('<article id="Card-'+t.Cedula+'" class="material-card '+sessionStorage.getItem("Color_card")+'"><h2><span>'+t.Nombre+"<\/span>"+votoBlanco(t.Cedula,t.Num_posicion)+'<\/h2><div class= "mc-content"><div class="img-container"><img id="img-'+t.Id_candidato+'" class="img-responsive" src="../Images/Candidatos/'+t.Foto+'"><\/div><div style="text-align:center;" class="mc-description"><h5><i class="far fa-5x fa-check-circle" style="color:red"><\/i><\/h5><\/div><\/div > <a class="mc-btn-action" id="'+t.Id_candidato+'"><i class="fa fa-plus fa-2x" style="color:red"><\/i><\/a> <div style="text-align:center;" class="mc-footer"><\/div ><\/article > ');r.appendTo(i);ListaCandidatos.push(i)}),$("#containerPanel").append(ListaCandidatos),n())},error:AjaxError})}function AccionesCargaCandidatos(){$(".material-card > .mc-btn-action").click(function(){var i=$(this).attr("id"),n=$(this).parent(".material-card"),t=$(this).children("i");t.addClass("fa-spin");n.hasClass("mc-active")?(DescarmarSeleccion(i,n,t),$("#VTDisponibles").text(Num_votos)):Num_votos===0?swalWithBootstrapButtons.fire({title:"NO TIENE VOTOS DISPONIBLES",html:"<h4>Totales <b>( "+sessionStorage.Num_votos+" )<\/b> - Disponibles  <b>( "+Num_votos+" )<\/b><\/h4>",type:"info",confirmButtonText:"VOLVER",timer:5e3}):(MarcarSeleccion(i,n,t),$("#VTDisponibles").text(Num_votos))});setTimeout(function(){$("html, body").animate({scrollTop:0})},500);setTimeout(function(){ocultarModal("modalCargando")},2e3);setTimeout(function(){$("#modalCargando").hasClass("show")&&ocultarModal("modalCargando")},6e3)}function DescarmarSeleccion(n,t,i){$("#btnVotar").length&&$("#btnVotar").remove();for(var r=0;r<Lista_candidatos.length;r++)Lista_candidatos[r]===n&&(Lista_candidatos.splice(r,1),r--,Num_votos++);$("#listaVotos .column#img-voto-"+n).remove();t.removeClass("mc-active");window.setTimeout(function(){i.removeClass("fa-minus").removeClass("fa-spin").addClass("fa-plus")},500)}function MarcarSeleccion(n,t,i){for(var e,o,u,f=n===Id_voto_blanco?Num_votos:1,r=0;r<f;r++)Lista_candidatos.push(n),Num_votos--,e=$("div.img-container #img-"+n+"").attr("src"),$("#listaVotos").append('<div class="column" id="img-voto-'+n+'"><img src="'+e+'" style="width:100%"><\/div>');Num_votos===0&&(o=$('<div id="avisoVotar" class="container-btn"><span class="circle"><i class="fa fa-arrow-down fa-btn"><\/i><\/span><span class="pulse"><\/span><\/div >'),u=$('<button type="button" id="btnVotar" class="btn btn-block btn-success btn-lg text-bold">VOTAR<\/button>'),u.prepend(o),u.appendTo(".card-footer"),$("html, body").animate({scrollTop:$(document).height()},500),Votar());t.addClass("mc-active");window.setTimeout(function(){i.removeClass("fa-plus").removeClass("fa-spin").addClass("fa-minus")},500)}function Votar(){$("#btnVotar").on("click",function(){swalWithBootstrapButtons.fire({title:$("#listaVotos").clone().prop("id","listaVotos2"),html:"<h4>Está seguro de su selección ?<\/h4>",type:"success",showCancelButton:!0,confirmButtonText:"--- SI ---",cancelButtonText:"--- NO ---",reverseButtons:!0}).then(function(n){n.value?(MostrarCargando(),AjaxRegistrarVoto(Lista_candidatos.join(","),GestionarRegistrarVoto)):n.dismiss===Swal.DismissReason.cancel&&mensajeVotoCancelado()})})}function AjaxRegistrarVoto(n,t){var i={Id_delegado:Id_delegado,Id_eleccion:Id_eleccion,Id_ronda:Id_ronda,Id_papeleta:Id_papeleta,Id_voto:Num_papeletas,Lista_candidatos:n,Usuario:Login};$.ajax({url:Uri+"/api/Voto/RegistrarVoto",method:"POST",async:!0,contentType:"application/json",dataType:"json",headers:{Auth:sessionStorage.Cedula+":"+sessionStorage.Token},data:JSON.stringify(i),success:function(n){n?t():mensajeVotoNoGuardado()},error:AjaxError})}function GestionarRegistrarVoto(){sessionStorage.setItem("Contador_papeletas",Contador_papeletas+1);Contador_papeletas=parseInt(sessionStorage.getItem("Contador_papeletas"));Contador_papeletas===Num_papeletas?mensajeVotoGuardadoConExito():Toast.fire({toast:!1,type:"success",title:"VOTO GUARDADO",html:"<h5>Cargando la próxima papeleta...<\/h5><\/br>",allowOutsideClick:!1,timer:3e3}).then(function(){AjaxCargarPapeletaActual_2(Login,Id_eleccion,Id_ronda,Id_delegado)})}function LimpiarRedireccionar(){sessionStorage.clear();redirect("Login.aspx")}function AjaxCargarPapeletaActual_2(n,t,i,r){var u={},f;u.Usuario=n;u.Id_eleccion=t;u.Id_ronda=i;u.Id_papeleta=0;u.Id_delegado=r;f=JSON.stringify({parametros:u});$.ajax({url:Uri+"/api/Asamblea/PapeletaRonda/PapeletaActual",method:"POST",data:f,async:!0,contentType:"application/json",dataType:"json",success:function(n){n!=="undefined"&&n!==""&&n!==null?(sessionStorage.setItem("Id_papeleta",n.Id_papeleta),sessionStorage.setItem("Num_papeletas",n.Num_papeletas),sessionStorage.setItem("Num_votos",n.Num_votos),sessionStorage.setItem("Id_voto_blanco",n.Id_voto_blanco),sessionStorage.setItem("Nombre_papeleta",n.Nombre),sessionStorage.setItem("Color_card",n.Color_card),sessionStorage.setItem("Color_background",n.Color_background),sessionStorage.setItem("Contador_papeletas",n.Contador_papeletas),location.reload()):mensajeNoPapeletasDisponibles()},error:AjaxError}).done(function(){CerrarCargando()})}function votoBlanco(n,t){return n!=="0"?"<strong># "+t+"<\/strong>":"<strong>*<\/strong>"}function DebugVariables(){console.log("Uri               : "+sessionStorage.Uri);console.log("Id_eleccion       : "+sessionStorage.Id_eleccion);console.log("Id_ronda          : "+sessionStorage.Id_ronda);console.log("Id_papeleta       : "+sessionStorage.Id_papeleta);console.log("Num_papeletas     : "+sessionStorage.Num_papeletas);console.log("Num_votos         : "+sessionStorage.Num_votos);console.log("Nombre_papeleta   : "+sessionStorage.Nombre_papeleta);console.log("Color_card        : "+sessionStorage.Color_card);console.log("Color_background  : "+sessionStorage.Color_background);console.log("Id_voto_blanco    : "+sessionStorage.Id_voto_blanco);console.log("Contador_papeletas: "+sessionStorage.Contador_papeletas);console.log("Cedula            : "+sessionStorage.Cedula);console.log("Nombre            : "+sessionStorage.Nombre);console.log("Id_usuario        : "+sessionStorage.Id);console.log("Id_delegado       : "+sessionStorage.Id_delegado);console.log("Token             : "+sessionStorage.Token);console.log("Rol               : "+sessionStorage.Rol)}function mensajeVotoNoGuardado(){Toast.fire({toast:!1,type:"error",title:"VOTO NO GUARDADO",html:"<h5>El voto de esta papeleta no fue guardado, se reiniciara su sesión.<\/h5><\/br>",allowOutsideClick:!1,timer:5e3}).then(function(){LimpiarRedireccionar();CerrarCargando()})}function mensajeVotoCancelado(){swalWithBootstrapButtons.fire({title:"VOTO CANCELADO",html:"<strong>Modifique su selección para votar nuevamente.<\/strong>",type:"info",confirmButtonText:"VOLVER"})}function mensajeNoPapeletasDisponibles(){Toast.fire({toast:!1,type:"error",title:"CARGA DE PAPELETAS",html:"<h5>El usuario no tiene papeletas disponibles para votar. Saliendo del sistema...<\/h5><\/br>",allowOutsideClick:!0,timer:5e3}).then(function(){LimpiarRedireccionar();CerrarCargando()})}function mensajeVotoGuardadoConExito(){let n;swalWithBootstrapButtons.fire({title:sessionStorage.Nombre,html:'<h4>VOTO GUARDADO CON ÉXITO&nbsp;<i class="fa fa-spinner fa-spin"><\/i>&nbsp;<strong class="text-danger"><\/strong><\/h4>',footer:"<a><strong>SU VOTO HA SIDO IMPRESO DIGITALMENTE<\/strong><\/br> - Votación finalizada.<\/br> - Gracias por cumplir su deber de Delegado.<\/br> - Su apoyo es valioso para COOPECAJA.<\/a>",imageUrl:"Images/UI/logo_coopecaja.png",imageHeight:140,type:"success",timer:1e4,allowOutsideClick:!1,showConfirmButton:!1,onBeforeOpen:function(){n=setInterval(function(){swal.getContent().querySelector("strong").textContent=Math.ceil(swal.getTimerLeft()/1e3)},100)},onClose:function(){clearInterval(n)}}).then(function(){CerrarCargando();LimpiarRedireccionar()})}const swalWithBootstrapButtons=Swal.mixin({customClass:{confirmButton:"btn btn-success",cancelButton:"btn btn-danger"},buttonsStyling:!1}),Toast=Swal.mixin({position:"center",showConfirmButton:!1});var Login,Cedula,Id_usuario,Id_delegado,Clave,Uri,Id_eleccion,Id_ronda,Id_papeleta,Contador_papeletas,Num_papeletas,Num_votos,Id_voto_blanco,Nombre_papeleta,Color_papeleta,Lista_candidatos=[];$(document).ready(function(){$("#btnSalir").length>0&&$("#btnSalir").remove();$("#btnInicio").length>0&&$("#btnInicio").remove();!$("#listaVotos").length>0&&$(".main-header").append('<div id="listaVotos" class="row"><\/div>');InicializarVariables(CargarCandidatos)});